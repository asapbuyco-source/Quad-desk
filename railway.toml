
[build]
builder = "nixpacks"
watchPatterns = ["backend/**"]

[phases.setup]
# Force Python 3.11 and essential build libraries
nixPkgs = ["python311", "gcc", "zlib"]
nixLibs = ["zlib"]

[phases.install]
# Navigate to backend folder to install dependencies
cmds = ["cd backend && pip install -r requirements.txt"]

[deploy]
# Navigate to backend folder and start Uvicorn
startCommand = "cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT"
healthcheckPath = "/health"
healthcheckTimeout = 120
restartPolicyType = "ON_FAILURE"
numReplicas = 1
